<!doctype html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Tr·∫Øc Nghi·ªám</title>
    <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/confetti-js@0.0.18/dist/index.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --body-bg: url('https://images.unsplash.com/photo-1507842217343-583bb7270b66?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            --container-bg: rgba(255, 239, 239, 0.95);
            --text-color: #1f2937;
            --header-color: #1e40af;
        }
        body.dark-theme {
            --body-bg: url('https://images.unsplash.com/photo-1481627834876-b7833e8f5570?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            --container-bg: rgba(30, 41, 59, 0.95);
            --text-color: #f1f5f9;
            --header-color: #93c5fd;
        }
        html, body { height: 100vh; width: 100vw; margin: 0; padding: 0; overflow: hidden; }
        body { font-family: 'Inter', 'Segoe UI', sans-serif; background: var(--body-bg) no-repeat center center fixed; background-size: cover; color: var(--text-color); }
        .container { position: absolute; top: 5px; left: 5px; right: 5px; bottom: 5px; width: auto; height: auto; overflow-y: auto; padding: 1.5rem; box-sizing: border-box; background: var(--container-bg); border-radius: 2rem; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); backdrop-filter: blur(5px); display: flex; flex-direction: column; }
        
        /* --- M√ÄU S·∫ÆC N√öT ƒêI·ªÄU H∆Ø·ªöNG --- */
        .question-nav-button { background-color: #e5e7eb; color: #4b5563; }
        .question-nav-button.answered { background-color: #22c55e; color: white; }
        .question-nav-button.current { background-color: #2563eb; color: white; transform: scale(1.1); }
        .question-nav-button.flagged { box-shadow: 0 0 0 3px #f59e0b inset; }

        /* --- CƒÇN CH·ªàNH THANH ƒêI·ªÄU H∆Ø·ªöNG --- */
        .question-nav-container { display: flex; width: 100%; background: rgba(0, 0, 0, 0.1); padding: 8px; border-radius: 8px; }
        @media (max-width: 1023px) {
            .question-nav-container { overflow-x: auto; }
            .nav-arrow { display: none; }
        }
        @media (min-width: 1024px) {
            .question-nav-container { justify-content: space-evenly; }
            .nav-arrow { display: block; }
        }
        
        /* C√°c style kh√°c gi·ªØ nguy√™n */
        h2 { text-align: center; color: var(--header-color); font-size: 2rem; font-weight: 700; margin-bottom: 1rem; }
        .question-block { display: none; border-radius: 1rem; background: linear-gradient(-45deg, #fef3c7, #fed7aa, #fecaca, #f3e8ff); background-size: 400% 400%; animation: glow 10s ease infinite; padding: 1.5rem; margin-bottom: 1rem; transition: opacity 0.2s ease-in-out; }
        .question-block.fade-out { opacity: 0; }
        button { background: linear-gradient(to right, #ec4899, #8b5cf6); color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 1rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
        input[type="file"] { margin: 1rem 0; padding: 0.5rem; border: 2px dashed #d1d5db; border-radius: 0.5rem; width: 100%; background: #f9fafb; color: #1f2937; }
        .popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10000; }
        .popup-content { background: white; color: #1f2937; padding: 2rem; border-radius: 1rem; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); text-align: center; max-width: 90vw; width: 500px; animation: popup-appear 0.3s ease-out forwards; position: relative; }
        @keyframes popup-appear { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .popup-close-btn { position: absolute; top: 10px; right: 15px; font-size: 1.5rem; font-weight: bold; cursor: pointer; color: #aaa; }
        .popup-close-btn:hover { color: #333; }
        .popup-icon { font-size: 3rem; margin-bottom: 1rem; }
        .popup-buttons button { padding: 0.6rem 1.2rem; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
        .popup-btn-confirm { background-color: #3b82f6; color: white; }
        .popup-btn-confirm:hover { background-color: #2563eb; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.5); z-index: 9999; }
        #optionsContainer label { display: flex; align-items: flex-start; background: rgba(255, 255, 255, 0.9); padding: 0.75rem; border-radius: 0.5rem; cursor: pointer; border: 2px solid transparent; transition: all 0.3s ease; word-break: break-word; color: #1f2937; }
        #optionsContainer label.correct { background: #dcfce7 !important; border-color: #22c55e !important; }
        #optionsContainer label.wrong { background: #fee2e2 !important; border-color: #ef4444 !important; }
        #optionsContainer label.disabled { pointer-events: none; opacity: 0.7; }
        #theme-switcher { position: fixed; top: 20px; right: 20px; font-size: 1.5rem; cursor: pointer; z-index: 100; }
        .question-nav-wrapper { display: none; align-items: center; justify-content: center; margin-bottom: 1rem; }
        .nav-arrow { cursor: pointer; font-size: 1.5rem; padding: 0 1rem; user-select: none; color: var(--text-color); }
        .question-nav-button { display: inline-block; width: 40px; height: 40px; line-height: 40px; text-align: center; font-weight: bold; border-radius: 50%; margin-right: 8px; cursor: pointer; transition: all 0.2s ease; flex-shrink: 0; }
        #red-flash-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: red; z-index: 99999; display: none; animation: flash-fade 5s forwards; }
        @keyframes flash-fade { 0% { opacity: 0.7; } 80% { opacity: 0.7; } 100% { opacity: 0; } }
        @keyframes glow { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
    </style>
</head>
<body>
    <div id="theme-switcher">‚òÄÔ∏è</div>
    <div class="container">
        <div id="loader" class="loader-overlay" style="display: none;"><div class="spinner"></div></div>

        <h2>üåü Tr·∫Øc Nghi·ªám üåü</h2>
        <input type="file" id="upload" accept=".docx" />
        
        <div id="fileLoadedActions" class="text-center mt-4 space-x-4" style="display:none;">
            <button onclick="clearFile()">üóëÔ∏è X√≥a file</button>
            <button onclick="showSettingsPopup('test')">üìù Ki·ªÉm tra</button>
            <button onclick="showSettingsPopup('practice')">üìö √în luy·ªán</button>
            <button onclick="showHistory()">üìú L·ªãch s·ª≠</button>
        </div>

        <div class="question-nav-wrapper" id="question-nav-wrapper">
            <div class="nav-arrow" id="nav-arrow-left">‚ùÆ</div>
            <div id="question-nav-container" class="question-nav-container"></div>
            <div class="nav-arrow" id="nav-arrow-right">‚ùØ</div>
        </div>
        <div class="text-center font-bold text-xl my-2" id="timerDisplay" style="display: none;"></div>
        <div id="quizContainer" class="question-block">
            <div id="questionText" class="text-lg font-semibold mb-4"></div>
            <div id="optionsContainer" class="space-y-3"></div>
            <div class="flex justify-between items-center mt-6 flex-wrap gap-3">
                <div class="flex gap-3">
                    <button onclick="prevQuestion()" id="prevBtn">‚¨ÖÔ∏è Quay l·∫°i</button>
                    <button onclick="nextQuestion()" id="nextBtn">Ti·∫øp theo ‚û°Ô∏è</button>
                </div>
                <div class="flex gap-3 items-center">
                    <button onclick="toggleFlag()" id="flagBtn">üö© ƒê√°nh d·∫•u</button>
                    <button onclick="useHelp()" id="helpBtn" style="display: none;">üí° 50/50 (<span id="helpCount">3</span>)</button>
                </div>
                <button onclick="submitQuiz()" id="submitBtn">N·ªôp b√†i</button>
            </div>
        </div>
        <div id="progressBar" class="mt-4 font-semibold text-center text-lg" style="display: none;"></div>
        
        <div class="button-group-wrapper mt-auto pt-4 text-center" id="extraButtonsWrapper">
            <div class="button-row space-x-4">
                <button onclick="window.location.href='chuyendoi.html'">Chu·∫©n h√≥a</button>
                <button onclick="window.location.href='kiemtra.html'">Trang ch·ªß</button>
            </div>
        </div>
    </div>
    
    <div class="overlay" id="overlay"></div>
    <div class="popup" id="popup">
        <div class="popup-content">
            <div class="popup-close-btn" onclick="closeAllPopups()">&times;</div>
            <div id="popupIcon" class="popup-icon"></div>
            <div id="popupMessage" class="text-lg font-medium"></div>
            <div id="popupButtons" class="mt-6 flex gap-4 justify-center flex-wrap"></div>
        </div>
    </div>
    <div id="red-flash-overlay"></div>
    <canvas id="confetti"></canvas>
    <script src="tracnghiem.js"></script>
</body>
</html>